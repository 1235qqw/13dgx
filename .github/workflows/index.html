<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>4 в ряд</title>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    background: #f0f0f0;
  }
  h1 {
    margin-top: 20px;
  }
  #board {
    margin: 20px auto;
    display: grid;
    grid-template-columns: repeat(7, 60px);
    grid-template-rows: repeat(6, 60px);
    gap: 5px;
    width: max-content;
    background: #0077cc;
    padding: 10px;
    border-radius: 10px;
  }
  .cell {
    width: 60px;
    height: 60px;
    background: #e1e1e1;
    border-radius: 50%;
    box-shadow: inset 0 0 5px #aaa;
    cursor: pointer;
  }
  .cell.red {
    background: red;
    box-shadow: inset 0 0 10px #800000;
  }
  .cell.yellow {
    background: yellow;
    box-shadow: inset 0 0 10px #aaaa00;
  }
  #message {
    font-size: 18px;
    margin-top: 15px;
  }
  #resetBtn {
    margin-top: 20px;
    padding: 8px 20px;
    font-size: 16px;
  }
</style>
</head>
<body>
<h1>Игра 4 в ряд</h1>
<div id="board"></div>
<div id="message">Ходит игрок: <span id="currentPlayer">Красный</span></div>
<button id="resetBtn">Начать заново</button>

<script>
  const rows = 6;
  const cols = 7;
  const board = [];
  let currentPlayer = 'red'; // red или yellow
  let gameOver = false;

  const boardDiv = document.getElementById('board');
  const message = document.getElementById('message');
  const currentPlayerSpan = document.getElementById('currentPlayer');
  const resetBtn = document.getElementById('resetBtn');

  // Инициализация пустой доски
  function initBoard() {
    boardDiv.innerHTML = '';
    for(let r = 0; r < rows; r++) {
      board[r] = [];
      for(let c = 0; c < cols; c++) {
        board[r][c] = null;
        const cell = document.createElement('div');
        cell.classList.add('cell');
        cell.dataset.row = r;
        cell.dataset.col = c;
        boardDiv.appendChild(cell);
      }
    }
  }

  // Найти нижнюю свободную ячейку в колонке
  function findRow(col) {
    for(let r = rows - 1; r >= 0; r--) {
      if(!board[r][col]) return r;
    }
    return -1;
  }

  // Проверка победы
  function checkWin(r, c) {
    function countDir(dr, dc) {
      let count = 0;
      let rr = r + dr;
      let cc = c + dc;
      while(rr >= 0 && rr < rows && cc >= 0 && cc < cols && board[rr][cc] === currentPlayer) {
        count++;
        rr += dr;
        cc += dc;
      }
      return count;
    }
    // Проверяем в 4 направлениях (горизонталь, вертикаль, две диагонали)
    if(countDir(0, 1) + countDir(0, -1) + 1 >= 4) return true;
    if(countDir(1, 0) + countDir(-1, 0) + 1 >= 4) return true;
    if(countDir(1, 1) + countDir(-1, -1) + 1 >= 4) return true;
    if(countDir(1, -1) + countDir(-1, 1) + 1 >= 4) return true;
    return false;
  }

  // Проверка ничьей
  function checkDraw() {
    for(let c = 0; c < cols; c++) {
      if(board[0][c] === null) return false;
    }
    return true;
  }

  // Обработка клика по ячейке (ставим фишку в колонку)
  boardDiv.addEventListener('click', (e) => {
    if(gameOver) return;
    if(!e.target.classList.contains('cell')) return;

    const col = Number(e.target.dataset.col);
    const row = findRow(col);
    if(row === -1) return; // колонка заполнена

    board[row][col] = currentPlayer;

    // Отрисовка фишки
    const cellDivs = boardDiv.children;
    for(let i = 0; i < cellDivs.length; i++) {
      const cell = cellDivs[i];
      if(Number(cell.dataset.row) === row && Number(cell.dataset.col) === col) {
        cell.classList.add(currentPlayer);
        break;
      }
    }

    if(checkWin(row, col)) {
      message.textContent = `Победил игрок: ${currentPlayer === 'red' ? 'Красный' : 'Жёлтый'}!`;
      gameOver = true;
      return;
    }

    if(checkDraw()) {
      message.textContent = 'Ничья! Все ячейки заполнены.';
      gameOver = true;
      return;
    }

    // Смена игрока
    currentPlayer = currentPlayer === 'red' ? 'yellow' : 'red';
    currentPlayerSpan.textContent = currentPlayer === 'red' ? 'Красный' : 'Жёлтый';
  });

  resetBtn.addEventListener('click', () => {
    initBoard();
    currentPlayer = 'red';
    gameOver = false;
    currentPlayerSpan.textContent = 'Красный';
    message.textContent = 'Ходит игрок: ';
  });

  // Старт игры
  initBoard();
</script>
</body>
</html>
